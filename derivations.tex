\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amssymb}
\usepackage[
    backend=biber,
    style=numeric,
    citestyle=numeric
]{biblatex}
\addbibresource{derivations.bib}
\usepackage[breaklinks=true, linkcolor=blue, citecolor=blue, colorlinks=true]{hyperref}

\newcommand{\pluseq}{\mathrel{{+}{=}}}
\newcommand{\minuseq}{\mathrel{{-}{=}}}
\newcommand{\ns}{\ensuremath{{N_{sp}}}}
\newcommand{\nr}{\ensuremath{{N_{reac}}}}
\newcommand{\conp}{CONP}
\newcommand{\conv}{CONV}
\newcommand{\dconp}{\ensuremath{,\qquad\text{for \conp}}}
\newcommand{\dconv}{\ensuremath{,\qquad\text{for \conv}}}
\newcommand{\Ru}{\ensuremath{\mathcal{R}}}

\begin{document}
\section{Introduction}
This document contains the complete derivations for \texttt{pyJac} v2.0, which generates code to evaluate the chemical source term and analytical chemical kinetic Jacobians of constant-pressure\slash constant-volume, fixed-mass, adiabatic reactors.
Note that equations specific to the constant-pressure or constant-volume derivation will be marked with \conp~or \conv~respectively.
The derivations in this script based upon the output of the script \href{https://github.com/arghdos/SPyJac-paper/blob/master/derivations/scripts/derivations.py}{derivations.py} in the GitHub repository for this paper.
This script depends on the symbolic mathematics library SymPy~\cite{sympy}, and was tested with versions 1.0 and 1.1.1

\section{State variables}

\begin{subequations}
\begin{align}
\Phi &= \left\{T, V, n_1, n_2 \ldots n_{\ns - 1}\right\}\dconp, \\
\Phi &= \left\{T, P, n_1, n_2 \ldots n_{\ns - 1}\right\}\dconv
\end{align}
\end{subequations}
where $T$ is the temperature, $P$ and $V$ the pressure and volume respectively, and $n_j$ the number of moles of the $j$th species in the model (containing $\ns$ total species).

From the ideal gas law, the number of moles of the final species is determined as:
\begin{subequations}
\begin{align}
n &= \frac{V P}{T \Ru} = \sum_{i=1}^{\ns}{n_i}, \label{source:moles}\\
n_{\ns} &= \frac{V P}{T \Ru} - \sum_{i=1}^{\ns - 1}{n_i}
\end{align}
\end{subequations}

\section{Chemical source terms}
The chemical source terms for this system are:
\begin{subequations}
\begin{align}
\frac{\text{d} \Phi }{\text{d} t } &= \left\{\frac{\text{d} T }{\text{d} t },\frac{\text{d} V }{\text{d} t },\frac{\text{d} n_1}{\text{d} t },\frac{\text{d} n_2 }{\text{d} t }\ldots \frac{\text{d} n_{\ns - 1} }{\text{d} t }\right\}\dconp, \\
\frac{\text{d} \Phi }{\text{d} t } &= \left\{\frac{\text{d} T }{\text{d} t },\frac{\text{d} P }{\text{d} t },\frac{\text{d} n_1}{\text{d} t },\frac{\text{d} n_2 }{\text{d} t }\ldots \frac{\text{d} n_{\ns - 1} }{\text{d} t }\right\}\dconv 
\end{align}
\end{subequations}
For both, the molar source terms are~\cite{TurnsStephenR2012Aitc}:
\begin{equation}
\frac{\text{d} n }{\text{d} t }_{k} = V \dot{\omega}_{k}
\label{source:spec}
\end{equation}
where $\dot{\omega}_k$ is the $kth$ species overall production rate, and the temperature production rates are~\cite{TurnsStephenR2012Aitc}:
\begin{subequations}
\label{source:temperature_incomplete}
\begin{align}
\frac{\text{d} T }{\text{d} t } &= - \frac{\sum_{k=1}^{\ns} H_{k} \dot{\omega}_{k}}{\sum_{k=1}^{\ns} [C]_{k} {C_{p, k}}}\dconp, \\
\frac{\text{d} T }{\text{d} t } &= - \frac{\sum_{k=1}^{\ns} U_{k} \dot{\omega}_{k}}{\sum_{k=1}^{\ns} [C]_{k} {C_{v, k}}}\dconv
\end{align}
\end{subequations}
where $H_k$, $U_k$, $C_{p,k}$ and $C_{v, k}$ are the enthalpy, internal energy, constant-pressure specific heat, constant-volume specific heat of species $k$ in molar units, while $[C]_{k}$ is the concentration.

From the ideal gas law, source terms for the volume and pressure variables may derived:
\begin{subequations}
\label{source:param_incomplete}
\begin{align}
\frac{\text{d} V }{\text{d} t } &= \frac{\Ru}{P} \left(T \frac{\text{d} n }{\text{d} t } + \frac{\text{d} T }{\text{d} t } n\right)\dconp, \\
\frac{\text{d} P }{\text{d} t } &= \frac{\Ru}{V} \left(T \frac{\text{d} n }{\text{d} t } + \frac{\text{d} T }{\text{d} t } n\right)\dconv
\end{align}
\end{subequations}

Finally, the conservation of mass is invoked:
\begin{align*}
 \frac{\text{d} m }{\text{d} t } &= 0 \\
 &= \sum_{k=1}^{\ns}  W_{k} \frac{\text{d} n }{\text{d} t }_{k},
\end{align*}
to determine the source term of the last species:
\begin{equation}
 \frac{\text{d} n }{\text{d} t }_{\ns} = - \frac{1}{W_{\ns}} \sum_{k=1}^{\ns - 1} W_{k} \frac{\text{d} n }{\text{d} t }_{k}
 \label{source:spec_ns}
\end{equation}
where $W_{k}$ is the molecular weight of the $k$th species.
Using~\eqref{source:spec_ns}, the total molar rate of change can be determined:
\begin{align}
\frac{\text{d} n }{\text{d} t } &= \sum_{k=1}^{\ns} \frac{\text{d} n }{\text{d} t }_{k}, \nonumber \\
\frac{\text{d} n }{\text{d} t } &= \sum_{k=1}^{\ns - 1} \left(1 - \frac{W_{k}}{W_{\ns}}\right) \frac{\text{d} n }{\text{d} t }_{k}
\label{source:total_molar}
\end{align}

Combining~\eqref{source:spec},\eqref{source:param_incomplete},\eqref{source:total_molar} gives the final form of the pressure and volume terms:
\begin{subequations}
\label{source:param_complete}
\begin{align}
\frac{\text{d} V }{\text{d} t } &= V \left(\frac{T \Ru}{P} \sum_{k=1}^{-1 + \ns} \left(1 - \frac{W_{k}}{W_{\ns}}\right) \dot{\omega}_{k} + \frac{1}{T} \frac{\text{d} T }{\text{d} t }\right)&\dconp, \\
\frac{\text{d} P }{\text{d} t } &= \frac{P}{T} \frac{\text{d} T }{\text{d} t } + T \Ru \sum_{k=1}^{-1 + \ns} \left(1 - \frac{W_{k}}{W_{\ns}}\right) \dot{\omega}_{k}&\dconv
\end{align}
\end{subequations}
Additionally, the temperature source terms may be expanded to contain only state variables (i.e., by removal of the last species' source term and overall production rate):
\begin{subequations}
\label{source:temperature_complete}
\begin{align}
\frac{\text{d} T }{\text{d} t } = - \frac{\sum_{k=1}^{-1 + \ns} \left(H_{k} - \frac{W_{k} H_{\ns}}{W_{\ns}}\right) \dot{\omega}_{k}}{[C] {C_{p,\ns}} + \sum_{k=1}^{-1 + \ns} \left(- {C_{p,\ns}} + {C_{p, k}}\right) [C]_{k}}\dconp,\\
\frac{\text{d} T }{\text{d} t } = - \frac{\sum_{k=1}^{-1 + \ns} \left(U_{k} - \frac{W_{k} U_{\ns}}{W_{\ns}}\right) \dot{\omega}_{k}}{[C] {C_{v,\ns}} + \sum_{k=1}^{-1 + \ns} \left(- {C_{v,\ns}} + {C_{v, k}}\right) [C]_{k}}\dconv
\end{align}
\end{subequations}
where $[C]$ is the total concentration:
\begin{equation}
 [C] = \frac{P}{T \Ru}
\end{equation}
This form is used for differentiation, but~\eqref{source:temperature_incomplete} will often be used as well due to its compactness.

\section{Thermal properties}
The standard-state thermodynamic properties (in molar units) for a gaseous species $k$ is defined using the standard seven-coefficient polynomial of Gordon and McBride~\cite{gordon1994computer}:
\begin{align}
\frac{C_{p,k}^{\circ}}{\mathcal{R}} &= a_{0,k} + T \left( a_{1,k} + T \left( a_{2,k} + T \left( a_{3,k} + a_{4,k} T \right) \right) \right) \label{e:cpk} \\
\frac{H_k^{\circ}}{\mathcal{R}} &= T \left( a_{0,k} + T \left( \frac{a_{1,k}}{2} + T \left( \frac{a_{2,k}}{3} + T \left( \frac{a_{3,k}}{4} + \frac{a_{4,k}}{5} T \right) \right) \right) \right) + a_{5,k} \label{e:hk} \\
\frac{S_k^{\circ}}{\mathcal{R}} &= a_{0,k} \ln T + T \left( a_{1,k} + T \left( \frac{a_{2,k}}{2} + T \left( \frac{a_{3,k}}{3} + \frac{a_{4,k}}{4} T \right) \right) \right) + a_{6,k} \label{e:sk}
\end{align}
where $C_{p,k}$ and $H_k$ are as described previously, $S_k$ is the entropy in molar units, and the ${}^{\circ}$ indicates a standard-state property at one atmosphere (equivalent to the property at any pressure for calorically perfect gases).

\section{Reaction rate expressions}
The net species rate of production is defined as:
\begin{equation}
 \dot{\omega}_{k} = \sum_{i=1}^{\nr} \nu_{k,i} q_{i}
\end{equation}
where $\nr$ is the number of reactions in the chemical kinetic model, $\nu_{k, i}$ the overall stoichionetric coefficient of species $k$ in reaction $i$ and $q_i$ the net rate-of-progress for reaction $i$:
\begin{align}
\nu_{k,i} &= \nu^{\prime}_{k,i} - \nu^{\prime\prime}_{k,i} \\
q_{i} &= R_{i} c_{i}
\end{align}
with $\nu^{\prime}_{k,i}$ and $\nu^{\prime\prime}_{k,i}$ the 



\printbibliography 

\end{document}
